<div *ngIf="loading" class="loading">
  <app-spinner></app-spinner>
</div>
<div class="container">
  <div class="pt-5 mt-5 testClass">
    <h5 for="password">Administrador</h5><br>
    <div class="input-group mb-3">
      <input type="text" class="form-control searchInput" [(ngModel)]="title" (keyup.enter)="inputSearch()" placeholder="Buscar por título...">
      <button type="button" class="btn btn-primary" (click)="inputSearch()" title="Pesquisar">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>
      <button type="button" class="btn btn-outline-secondary" *ngIf="title" (click)="clearSearch()" title="Limpar Pesquisa">
        <i class="fa-solid fa-eraser"></i>
      </button>
    </div>

    <div class="d-flex flex-wrap gap-2 mb-3">
      <button type="button" class="btn btn-secondary" (click)="exportCSV()" title="Exportar para CSV/Excel" [disabled]="!bookPage || bookPage.content.length === 0">
        <i class="fa-solid fa-file-csv"></i>
      </button>
      <!-- Botão Imprimir agora está funcional -->
      <button type="button" class="btn btn-secondary" (click)="printReport()" title="Gerar PDF" [disabled]="!bookPage || bookPage.content.length === 0">
        <i class="fa-solid fa-print"></i>
      </button>
      <!-- Botões de Ação Globais -->
      <button class="btn btn-warning" (click)="goEdit()" title="Editar Livro Selecionado" [disabled]="!selectedBookForAction">
        <i class="fas fa-edit"></i>
      </button>
      <button class="btn btn-danger" (click)="createDeleteBookRequest()" title="Excluir Livro Selecionado" [disabled]="!selectedBookForAction">
        <i class="fas fa-trash"></i>
      </button>
    </div>

    <div class="alert alert-danger mt-3" *ngIf="errorMessage">
      {{errorMessage}}
    </div>

    <div class="card mt-3" *ngIf="bookPage">
      <div class="card-header">
        <div class="row align-items-center">
          <div class="col-6">
            <h3>E-books</h3>
          </div>
          <div class="col-6 text-end">
            <button class="btn btn-primary" routerLink="/admin/book-form">
              <i class="fa-solid fa-plus"></i>
              <span class="d-none d-sm-inline">Adicionar</span>
            </button>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Título</th>
                <th scope="col">Preço</th>
                <th scope="col">Desconto</th>
                <th scope="col">Autor</th>
                <th scope="col">Data</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of bookPage.content; index as ind;" (click)="selectRow(item)" [class.table-active]="item === selectedBookForAction" style="cursor: pointer;">
                <th scope="row">{{(bookPage.number * bookPage.size) + ind + 1}}</th>
                <td>{{item.title}}</td>
                <td>{{item.price | currency: 'BRL'}}</td>
                <td>{{item.discount_price | currency: 'BRL'}}</td>
                <td>{{item.author}}</td>
                <td>{{item.createTime | date: 'dd/MM/yyyy HH:mm'}}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination Controls -->
        <nav *ngIf="bookPage.totalPages > 1" aria-label="Page navigation">
          <ul class="pagination justify-content-center flex-wrap">
            <li class="page-item" [class.disabled]="bookPage.number === 0">
              <a class="page-link" (click)="changePage(bookPage.number - 1)" aria-label="Previous">&laquo;</a>
            </li>
            <li *ngFor="let pageNum of pageNumbers" class="page-item" [class.active]="pageNum === bookPage.number + 1">
              <a class="page-link" (click)="changePage(pageNum - 1)">{{ pageNum }}</a>
            </li>
            <li class="page-item" [class.disabled]="bookPage.number === bookPage.totalPages - 1">
              <a class="page-link" (click)="changePage(bookPage.number + 1)" aria-label="Next">&raquo;</a>
            </li>
          </ul>
        </nav>

      </div>
    </div>
  </div>
</div>

<app-deletebook (deleteSuccess)="refreshBookList()"></app-deletebook>
