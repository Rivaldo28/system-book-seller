<div *ngIf="loading" class="loading">
  <app-spinner></app-spinner>
</div>
<div class="container content-area">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="form-floating mb-3">
        <input
          type="text"
          class="form-control"
          id="titleSearch"
          placeholder="Buscar por título..."
          [(ngModel)]="title"
          (keyup.enter)="search()"
          />
          <label for="titleSearch">Buscar por Título no Histórico</label>
        </div>
      <div class="card">
        <div class="card-header">
          <h3>Meu Histórico de Compras</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Título</th>
                  <th scope="col">Preço</th>
                  <th scope="col">Desconto</th>
                  <th scope="col">Data da Compra</th>
                </tr>
              </thead>
              <tbody *ngIf="purchasePage && purchasePage.content.length > 0">
                <tr *ngFor="let item of purchasePage.content; index as ind ">
                  <th scope="row">{{(purchasePage.number * purchasePage.size) + ind + 1}}</th>
                  <td>{{item.title}}</td>
                  <td>{{item.price | currency: 'BRL'}}</td>
                  <td>{{item.discountPrice | currency: 'BRL'}}</td>
                  <td>{{item.purchaseTime | date: 'dd/MM/yyyy HH:mm'}}</td>
                </tr>
              </tbody>
              <tbody *ngIf="!purchasePage || purchasePage.content.length === 0">
                <tr>
                  <td colspan="5" class="text-center">Nenhum item encontrado.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination Controls -->
          <nav *ngIf="purchasePage && purchasePage.totalPages > 1" aria-label="Page navigation">
            <ul class="pagination justify-content-center flex-wrap">
              <li class="page-item" [class.disabled]="purchasePage.number === 0">
                <a class="page-link" (click)="changePage(purchasePage.number - 1)" aria-label="Previous">&laquo;</a>
              </li>
              <li *ngFor="let pageNum of pageNumbers" class="page-item" [class.active]="pageNum === purchasePage.number + 1">
                <a class="page-link" (click)="changePage(pageNum - 1)">{{ pageNum }}</a>
              </li>
              <li class="page-item" [class.disabled]="purchasePage.number === purchasePage.totalPages - 1">
                <a class="page-link" (click)="changePage(purchasePage.number + 1)" aria-label="Next">&raquo;</a>
              </li>
            </ul>
          </nav>

        </div>
      </div>
    </div>
  </div>
</div>
